# 01 | 高并发系统：它的通用设计方法是什么？

应对高并发大流量时，采用的三种方法：

- 横向拓展 分布式部署 数据库一主多从 分库分表 存储分片
- 缓存思想 任何降低响应时间的中间存储
- 异步处理



# 02 | 架构分层：我们为什么一定要这么做？

分层的优势：

- 简化系统设计，让不同的人专注做某一层次的事
- 带来高复用性
- 更容易横向扩展



Manager 层：通用业务处理层。这一层主要有两个作用，其一，你可以将原先 Service 层的一些通用能力下沉到这一层，比如与缓存和存储交互策略，中间件的接入；其二，你也可以在这一层封装对第三方接口的调用，比如调用支付服务，调用审核服务等。



# 03 | 系统设计目标（一）：如何提升系统性能？

高并发下的性能优化：

1. 提高系统的处理核心数 但是当并发压力过大时 反而会导致吞吐量的降低 这是因为资源争取过于严重 所以需要通过压测来找到所谓的”拐点“
2. 减少单次任务的响应时间





# 04 | 系统设计目标（二）：系统怎样做到高可用？

高可用系统设计的思路：

**1.系统设计：故障转移、超时控制、降级限流**

故障转移分为对等节点和不对等节点，不对等即主从，相比于对等更加复杂，需要进行选举

对于超时时间的控制，由于时间太长会导致客户端线程阻塞在慢请求上，而太短又会导致大量的超时错误，所以可以收集日志，统计比如说99%的请求的响应时间是怎样的，依据这个来指定超时时间

降级是为了保证核心服务的稳定而牺牲非核心服务的做法，限流则是另一种思路，对并发的请求进行限速来保护系统



**2.系统运维：**灰度发布、故障演练、混沌工程



# 05 | 系统设计目标（三）：如何让系统易于扩展？

**为什么提示扩展性会很复杂：**

1.不同的系统分层上可能存在”瓶颈“，比如后端服务扩容加机器后，MySQL可能成为瓶颈

2.无状态的服务和组件更易于扩展，而像MySQL这种存储服务是有状态的，会涉及大量的数据迁移



**高可扩展性的设计思路：**

1.拆分，相对于大系统来说，考虑一个个小模块的扩展性当然会简单一些，而且可以根据不同模块的流量大小动态调整

2.存储层的扩展性首先考虑的是业务维度，不同的模块拆分为不同的库，然后做水平维度的拆分，就是常见的分库分表

3.业务层的扩展性：业务维度，重要性维度、请求来源维度



# 07 | 池化技术：如何减少频繁创建数据库连接的性能损耗？

1.数据库连接池一般线上最小连接数控制在10左右，最大连接数20~30左右

2.池子的预热，线程池可以通过prestartAllCoreThreads预先启动核心线程

3.池化技术是空间换时间思想的实践，所以要关注空间占用情况，避免出现内存泄漏和频繁GC，频繁GC由于STW的也会导致服务可用性降低



# 08 | 数据库优化方案（一）：查询请求增加时，如何做主从分离？

1.在 4 核 8G 的机器上运 MySQL 5.7 时，大概可以支撑 500 的 TPS 和 10000 的 QPS

2.主从读写的两个技术关键点

- 主从复制：

